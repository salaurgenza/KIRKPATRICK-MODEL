<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Valutazione Livello 1 - Kirkpatrick</title>
  <style>
    :root{--bg:#f7f9fb;--card:#ffffff;--accent:#0b63c6;--muted:#6b7280}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:900px;margin:32px auto;padding:20px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06);padding:20px;margin-bottom:16px}
    h1{margin:0 0 8px 0;font-size:20px}
    p.lead{color:var(--muted);margin:0 0 12px 0}
    label{display:block;margin-bottom:6px;font-weight:600}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    .likert{display:flex;gap:6px;align-items:center}
    .likert input{display:none}
    .likert label{padding:8px 10px;border-radius:8px;background:#efefef;cursor:pointer}
    .likert input:checked + label{background:var(--accent);color:white}
    textarea{width:100%;min-height:90px;padding:8px;border-radius:8px;border:1px solid #e6e9ee}
    input[type=text], input[type=date]{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ee}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#fff;cursor:pointer}
    .btn.secondary{background:#6b7280}
    .muted{color:var(--muted);font-size:13px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid #eef2f7;text-align:left}
    .small{font-size:13px}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Valutazione - Livello 1 (Reazione)</h1>
      <p class="lead">Questionario di gradimento, feedback e sondaggi sulla soddisfazione. Usa questo modulo per raccogliere le reazioni immediate dei partecipanti.</p>

      <form id="feedbackForm">
        <div class="row">
          <div class="col">
            <label for="course">Corso / Evento</label>
            <input type="text" id="course" name="course" placeholder="Titolo corso">
          </div>
          <div class="col">
            <label for="date">Data</label>
            <input type="date" id="date" name="date">
          </div>
        </div>

        <div style="margin-top:12px">
          <label for="participant">Partecipante (opzionale)</label>
          <input type="text" id="participant" name="participant" placeholder="Nome o ID partecipante">
        </div>

        <hr>

        <div class="card small">
          <label>Valuta i seguenti aspetti (1 = molto insoddisfatto, 5 = molto soddisfatto)</label>

          <div style="margin-top:8px">
            <div class="small">Congruenza dei contenuti rispetto agli obiettivi enunciati</div>
            <div class="likert" data-name="satisfaction">
              <input type="radio" id="s1" name="satisfaction" value="1"><label for="s1">1</label>
              <input type="radio" id="s2" name="satisfaction" value="2"><label for="s2">2</label>
              <input type="radio" id="s3" name="satisfaction" value="3"><label for="s3">3</label>
              <input type="radio" id="s4" name="satisfaction" value="4"><label for="s4">4</label>
              <input type="radio" id="s5" name="satisfaction" value="5"><label for="s5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Rispondenza dei contenuti formativi rispetto alle aspettative iniziali</div>
            <div class="likert">
              <input type="radio" id="c1" name="clarity" value="1"><label for="c1">1</label>
              <input type="radio" id="c2" name="clarity" value="2"><label for="c2">2</label>
              <input type="radio" id="c3" name="clarity" value="3"><label for="c3">3</label>
              <input type="radio" id="c4" name="clarity" value="4"><label for="c4">4</label>
              <input type="radio" id="c5" name="clarity" value="5"><label for="c5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Applicabilità degli argomenti trattati in ambito lavorativo</div>
            <div class="likert">
              <input type="radio" id="r1" name="relevance" value="1"><label for="r1">1</label>
              <input type="radio" id="r2" name="relevance" value="2"><label for="r2">2</label>
              <input type="radio" id="r3" name="relevance" value="3"><label for="r3">3</label>
              <input type="radio" id="r4" name="relevance" value="4"><label for="r4">4</label>
              <input type="radio" id="r5" name="relevance" value="5"><label for="r5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Rispondenza dei contenuti formativi rispetto al fabbisogno formativo</div>
            <div class="likert">
              <input type="radio" id="m1" name="materials" value="1"><label for="m1">1</label>
              <input type="radio" id="m2" name="materials" value="2"><label for="m2">2</label>
              <input type="radio" id="m3" name="materials" value="3"><label for="m3">3</label>
              <input type="radio" id="m4" name="materials" value="4"><label for="m4">4</label>
              <input type="radio" id="m5" name="materials" value="5"><label for="m5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Efficacia delle simulazioni video (MindEx)</div>
            <div class="likert">
              <input type="radio" id="v1a" name="video" value="1"><label for="v1a">1</label>
              <input type="radio" id="v2a" name="video" value="2"><label for="v2a">2</label>
              <input type="radio" id="v3a" name="video" value="3"><label for="v3a">3</label>
              <input type="radio" id="v4a" name="video" value="4"><label for="v4a">4</label>
              <input type="radio" id="v5a" name="video" value="5"><label for="v5a">5</label>
            </div>
          </div>

          <hr>
          <h2>DOCENTI</h2>

          <div style="margin-top:8px">
            <div class="small">Padronanza dei contenuti e chiarezza espositiva</div>
            <div class="likert">
              <input type="radio" id="d1" name="docenti_contenuti" value="1"><label for="d1">1</label>
              <input type="radio" id="d2" name="docenti_contenuti" value="2"><label for="d2">2</label>
              <input type="radio" id="d3" name="docenti_contenuti" value="3"><label for="d3">3</label>
              <input type="radio" id="d4" name="docenti_contenuti" value="4"><label for="d4">4</label>
              <input type="radio" id="d5" name="docenti_contenuti" value="5"><label for="d5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Organicità e sequenzialità nella presentazione degli argomenti</div>
            <div class="likert">
              <input type="radio" id="o1" name="docenti_organizzazione" value="1"><label for="o1">1</label>
              <input type="radio" id="o2" name="docenti_organizzazione" value="2"><label for="o2">2</label>
              <input type="radio" id="o3" name="docenti_organizzazione" value="3"><label for="o3">3</label>
              <input type="radio" id="o4" name="docenti_organizzazione" value="4"><label for="o4">4</label>
              <input type="radio" id="o5" name="docenti_organizzazione" value="5"><label for="o5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Gestione attività in simulazione: capacità tecniche, comunicative e relazionali</div>
            <div class="likert">
              <input type="radio" id="g1" name="docenti_gestione" value="1"><label for="g1">1</label>
              <input type="radio" id="g2" name="docenti_gestione" value="2"><label for="g2">2</label>
              <input type="radio" id="g3" name="docenti_gestione" value="3"><label for="g3">3</label>
              <input type="radio" id="g4" name="docenti_gestione" value="4"><label for="g4">4</label>
              <input type="radio" id="g5" name="docenti_gestione" value="5"><label for="g5">5</label>
            </div>
          </div>

          <hr>
          <h2>MATERIALE DIDATTICO E MODELLI DI FORMAZIONE</h2>

          <div class="small">Come giudica il materiale didattico utilizzato?</div>
          <div class="likert">
            <input type="radio" id="md1" name="materiale_didattico" value="1"><label for="md1">1</label>
            <input type="radio" id="md2" name="materiale_didattico" value="2"><label for="md2">2</label>
            <input type="radio" id="md3" name="materiale_didattico" value="3"><label for="md3">3</label>
            <input type="radio" id="md4" name="materiale_didattico" value="4"><label for="md4">4</label>
            <input type="radio" id="md5" name="materiale_didattico" value="5"><label for="md5">5</label>
          </div>

          <div style="margin-top:8px">
            <div class="small">Come giudica le esercitazioni pratiche in aula?</div>
            <div class="likert">
              <input type="radio" id="me1" name="materiale_esercitazioni" value="1"><label for="me1">1</label>
              <input type="radio" id="me2" name="materiale_esercitazioni" value="2"><label for="me2">2</label>
              <input type="radio" id="me3" name="materiale_esercitazioni" value="3"><label for="me3">3</label>
              <input type="radio" id="me4" name="materiale_esercitazioni" value="4"><label for="me4">4</label>
              <input type="radio" id="me5" name="materiale_esercitazioni" value="5"><label for="me5">5</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Come giudica la realizzazione della Live Simulation?</div>
            <div class="likert">
              <input type="radio" id="ml1" name="materiale_live" value="1"><label for="ml1">1</label>
              <input type="radio" id="ml2" name="materiale_live" value="2"><label for="ml2">2</label>
              <input type="radio" id="ml3" name="materiale_live" value="3"><label for="ml3">3</label>
              <input type="radio" id="ml4" name="materiale_live" value="4"><label for="ml4">4</label>
              <input type="radio" id="ml5" name="materiale_live" value="5"><label for="ml5">5</label>
            </div>
          </div>
        </div>

        <div style="margin-top:12px">
          <label for="strengths">Punti di forza</label>
          <textarea id="strengths" name="strengths" placeholder="Cosa ti è piaciuto maggiormente?"></textarea>
        </div>

        <div style="margin-top:12px">
          <label for="improvements">Miglioramenti suggeriti</label>
          <textarea id="improvements" name="improvements" placeholder="Cosa migliorerebbe il corso?"></textarea>
        </div>

        <div style="margin-top:12px">
          <label for="other">Altri commenti</label>
          <textarea id="other" name="other" placeholder="Commenti liberi"></textarea>
        </div>

        <div style="margin-top:12px" class="actions">
          <button type="button" class="btn" onclick="saveResponse()">Invia feedback</button>
          <button type="button" class="btn secondary" onclick="showSummary()">Visualizza riepilogo</button>
          <button type="button" class="btn secondary" onclick="exportPDF()">Esporta PDF</button>
        </div>
      </form>
    </div>

    <div class="card" id="summaryCard" style="display:none">
      <h2>Riepilogo risposte</h2>
      <div id="summary"></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'kirkpatrick_level1_responses';
    const keys = ['satisfaction','clarity','relevance','materials','video','docenti_contenuti','docenti_organizzazione','docenti_gestione','materiale_didattico','materiale_esercitazioni','materiale_live'];

    function getFormData(){
      const fd = new FormData(document.getElementById('feedbackForm'));
      const obj = {};
      for(const [k,v] of fd.entries()) obj[k]=v;
      obj.timestamp = new Date().toISOString();
      return obj;
    }

    function saveResponse(){
      const data = getFormData();
      if(!data.satisfaction){ alert('Valuta almeno la soddisfazione generale (1-5).'); return; }
      const arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      arr.push(data);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
      alert('Feedback salvato localmente.');
      document.getElementById('feedbackForm').reset();
    }

    function labelForKey(k){
      const map = {
        satisfaction:'Soddisfazione generale',
        clarity:'Chiarezza dei contenuti',
        relevance:'Rilevanza per il ruolo',
        materials:'Fabbisogno formativo',
        video:'Simulazioni video (MindEx)',
        docenti_contenuti:'Docenti - Padronanza e chiarezza',
        docenti_organizzazione:'Docenti - Organizzazione e sequenza',
        docenti_gestione:'Docenti - Gestione attività',
        materiale_didattico:'Materiale didattico',
        materiale_esercitazioni:'Esercitazioni pratiche',
        materiale_live:'Live Simulation'
      };
      return map[k] || k;
    }

    function showSummary(){
      const arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      const container = document.getElementById('summary');
      container.innerHTML = '';
      if(!arr.length){ container.innerHTML='<p class="muted">Nessuna risposta.</p>'; return; }

      const stats={}; keys.forEach(k=>stats[k]={sum:0,count:0});
      arr.forEach(r=>keys.forEach(k=>{ if(r[k]){ stats[k].sum+=+r[k]; stats[k].count++; }}));

      let html='<table><thead><tr><th>Voce</th><th>Media</th><th>Risposte</th></tr></thead><tbody>';
      keys.forEach(k=>{
        const s=stats[k]; const avg=s.count?(s.sum/s.count).toFixed(2):'-';
        html+=`<tr><td>${labelForKey(k)}</td><td>${avg}</td><td>${s.count}</td></tr>`;
      });
      html+='</tbody></table>';
      container.innerHTML=html;

      ['strengths','improvements','other'].forEach(t=>{
        const title={strengths:'Punti di forza',improvements:'Miglioramenti',other:'Altri commenti'}[t];
        html+=`<h3>${title}</h3><ul>`;
        arr.forEach(r=>{ if(r[t]) html+=`<li>${r[t]}</li>`; });
        html+='</ul>';
      });
      container.innerHTML=html;
      document.getElementById('summaryCard').style.display='block';
    }

    async function exportPDF(){
      const { jsPDF } = window.jspdf;
      const arr = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      if(!arr.length){ alert('Nessuna risposta da esportare'); return; }

      const doc = new jsPDF({orientation:'portrait'});
      doc.setFontSize(14);
      doc.text('Valutazione - Livello 1 (Reazione)', 10, 15);
      doc.setFontSize(11);
      doc.text(`Totale risposte: ${arr.length}`, 10, 22);

      // Tabelle medie
      let y=30;
      const stats={}; keys.forEach(k=>stats[k]={sum:0,count:0});
      arr.forEach(r=>keys.forEach(k=>{ if(r[k]){ stats[k].sum+=+r[k]; stats[k].count++; }}));
      keys.forEach(k=>{
        const s=stats[k]; const avg=s.count?(s.sum/s.count).toFixed(2):'-';
        doc.text(`${labelForKey(k)}: media ${avg} (${s.count})`,10,y);
        y+=6; if(y>270){ doc.addPage(); y=20; }
      });

      // Commenti
      y+=10; doc.setFontSize(13); doc.text('Commenti:',10,y); y+=6; doc.setFontSize(11);
      arr.forEach((r,i)=>{
        if(r.strengths || r.improvements || r.other){
          doc.text(`Risposta #${i+1}`,10,y); y+=6;
          if(r.strengths){ doc.text(`• Punti di forza: ${r.strengths}`,12,y); y+=6; }
          if(r.improvements){ doc.text(`• Miglioramenti: ${r.improvements}`,12,y); y+=6; }
          if(r.other){ doc.text(`• Altri commenti: ${r.other}`,12,y); y+=8; }
          if(y>270){ doc.addPage(); y=20; }
        }
      });

      doc.save('kirkpatrick_level1_report.pdf');
    }

    document.addEventListener('DOMContentLoaded',()=>{ document.getElementById('date').value=new Date().toISOString().slice(0,10); });
  </script>
</body>
</html>
